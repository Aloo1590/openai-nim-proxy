version: '3.8'

services:
  nvidia-nim-proxy:
    build:
      context: .
      dockerfile: Dockerfile_nodejs
    ports:
      - "3000:3000"
    environment:
      - NIM_API_KEY=${NIM_API_KEY}
      - NIM_API_BASE=${NIM_API_BASE:-https://integrate.api.nvidia.com/v1}
      - PORT=3000
      - SHOW_REASONING=${SHOW_REASONING:-false}
      - ENABLE_THINKING_MODE=${ENABLE_THINKING_MODE:-false}
      - REQUEST_TIMEOUT=${REQUEST_TIMEOUT:-120000}
    restart: unless-stopped
    container_name: nvidia-nim-proxy
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000/health', (r) => { process.exit(r.statusCode === 200 ? 0 : 1); })"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s

# Usage:
# 1. Create .env file with NIM_API_KEY=your-key
# 2. Run: docker-compose up -d
# 3. Access at http://localhost:3000
# 4. View logs: docker-compose logs -f
# 5. Stop: docker-compose down
